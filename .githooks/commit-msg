#!/usr/bin/env bash
set -euo pipefail
MSG="$1"

# ЩО БЛОКУЄМО (патерни): службові рядки від інструментів/LLM
banned_msg='(?im)^\s*Generated with\s*\[.*?\]|^\s*AI-?generated\b|^\s*Co-Authored-By:\s.*'
# А ще забороняємо "ботів" в полі автора/комітера (список можна розширити)
banned_author='(?i)(bot|assistant|automation|noreply@.*)'

bad=""

# 1) Повідомлення коміту
if grep -Pq "$banned_msg" "$MSG"; then
  bad="message"
fi

# 2) Автор/комітер
author_ident="$(git var GIT_AUTHOR_IDENT 2>/dev/null || true)"
committer_ident="$(git var GIT_COMMITTER_IDENT 2>/dev/null || true)"
if printf '%s\n%s\n' "$author_ident" "$committer_ident" | grep -Pq "$banned_author"; then
  bad="author"
fi

if [ -n "$bad" ]; then
  cat >&2 <<'EOF'
❌ Коміт ЗАБЛОКОВАНО.

Причина: виявлено службові рядки, що приписують зміни мовній моделі/інструменту (Generated with , Co-Authored-By: ),
або неавтентичного автора/комітера (бот/асистент/автоматизація).

ЦЕ АБСОЛЮТНО НЕПРИЙНЯТНО:
 Код у цьому репозиторії є виключно авторським продуктом розробника.
 Мовна модель не редагувала код і не може привласнювати собі авторство чи співавторство.
 Ми зберігаємо автентичну, людську історію змін; будь-які машинні футери/трейлери/авторство заборонені.

Вимоги:
1) Прибери всі подібні рядки з повідомлення коміту.
2) Коміт має бути максимально автентичним і людським  без машинних нагадувань.
3) Автор/Комітер  тільки реальна особа (не бот/асистент/автоматизація).

Як виправити:
 Відредагуй повідомлення:  git commit --amend
 Перевір дані автора:      git config user.name "Твоє ім'я"; git config user.email "ти@домен"
EOF
  exit 1
fi
